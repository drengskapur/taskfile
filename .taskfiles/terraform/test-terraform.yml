name: Test Terraform Installation

on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.taskfiles/terraform/**'
  push:
    branches: [ main, develop ]
    paths:
      - '.taskfiles/terraform/**'

jobs:
  test-local:
    name: Test terraform installation (Local)
    runs-on: ubuntu-22.04
    container:
      image: ubuntu:22.04
      options: --privileged
    steps:
      - uses: actions/checkout@v3

      - name: Install base system utilities
        run: |
          apt-get update
          apt-get install -y \
            ca-certificates \
            curl \
            jq \
            unzip

      - name: Install Task
        run: |
          sh -c "$(curl --location https://taskfile.dev/install.sh)" -- -d -b /usr/local/bin

      - name: Install terraform
        working-directory: .taskfiles/terraform
        run: task install

      - name: Test terraform installation
        working-directory: .taskfiles/terraform
        run: task test

      - name: Complete job
        run: echo "Test completed successfully"

  test-github:
    name: Test terraform installation (GitHub)
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3

      - name: Install Task
        run: |
          sh -c "$(curl --location https://taskfile.dev/install.sh)" -- -d -b /usr/local/bin

      - name: Install terraform
        working-directory: .taskfiles/terraform
        run: task install

      - name: Test terraform installation
        working-directory: .taskfiles/terraform
        run: task test

      - name: Complete job
        run: echo "Test completed successfully"
