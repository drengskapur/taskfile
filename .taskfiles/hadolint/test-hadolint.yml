name: Test Hadolint Installation

on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.taskfiles/hadolint/**'
  push:
    branches: [ main, develop ]
    paths:
      - '.taskfiles/hadolint/**'

jobs:
  test-local:
    name: Test hadolint installation (Local)
    runs-on: ubuntu-22.04
    container:
      image: ubuntu:22.04
      options: --privileged
    steps:
      - uses: actions/checkout@v3

      - name: Install base system utilities
        run: |
          apt-get update
          apt-get install -y \
            ca-certificates \
            curl \
            jq

      - name: Install Task
        run: |
          sh -c "$(curl --location https://taskfile.dev/install.sh)" -- -d -b /usr/local/bin

      - name: Install hadolint
        working-directory: .taskfiles/hadolint
        run: task install

      - name: Test hadolint installation
        working-directory: .taskfiles/hadolint
        run: task test

      - name: Complete job
        run: echo "Test completed successfully"

  test-github:
    name: Test hadolint installation (GitHub)
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3

      - name: Install Task
        run: |
          sh -c "$(curl --location https://taskfile.dev/install.sh)" -- -d -b /usr/local/bin

      - name: Install hadolint
        working-directory: .taskfiles/hadolint
        run: task install

      - name: Test hadolint installation
        working-directory: .taskfiles/hadolint
        run: task test

      - name: Complete job
        run: echo "Test completed successfully"
